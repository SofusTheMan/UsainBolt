{% extends "base.html" %}

{% block content %}
<h2>Upload a Meter</h2>
<form id="uploadForm" method="POST" enctype="multipart/form-data">
    <label for="username">Username:</label>
    <input type="text" id="username" name="username" list="usernames" autocomplete="off" required>
    <datalist id="usernames">
        {% for user in users %}
        <option value="{{ user.username }}">
        {% endfor %}
    </datalist>

    <label for="description">Description (optional):</label>
    <input type="text" name="description">

    <label for="time_seconds">Time (seconds):</label>
    <input type="number" step="0.01" name="time_seconds" required>

    <label for="video">Video File:</label>
    <input type="file" name="video" accept="video/*" required>

    <button type="submit">Upload</button>
</form>

<script>
    document.getElementById("uploadForm").addEventListener("submit", function(event) {
        const input = document.getElementById("username");
        const typedName = input.value.trim().toLowerCase();

        // collect existing usernames (from datalist)
        const existingNames = Array.from(document.querySelectorAll("#usernames option"))
            .map(opt => opt.value.toLowerCase());

        if (!existingNames.includes(typedName)) {
            const confirmNew = confirm(
                `"${input.value}" is a new user. Did you mean to create a new user?`
            );
            if (!confirmNew) {
                // stop form submission so the user can change it
                event.preventDefault();
                input.focus();
            }
        }
    });
</script>
{% endblock %}
